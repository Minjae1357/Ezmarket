<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>장바구니</title>
<style>
	 
.image1 {
width: auto;
height: 150px;
}
	 
.all {
margin: 0 auto;
}

h2 {
	text-align:center;
}

table {
font-family: Arial, sans-serif;
margin: 0 auto;
border: 5px solid black;
border-collapse: collapse;
}

td {
    border: 5px solid black;
    padding: 8px;
}

.searchdiv {
    display: flex;
    justify-content: center; /* 가로 방향에서 중앙 정렬 */
    align-items: center; /* 세로 방향에서 중앙 정렬 */
    margin: 10px 0; /* 상하 마진 추가로 조정 */
}


.image-container {
position: relative;
display: inline-block;
}

.image-container img {
width: auto;
height: 150px;

}
.overlay-text {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: white;
    background: rgba(0, 0, 0, 0.7); /* 반투명 검정 배경 */
    display: flex;
    justify-content: center; /* 가로 중앙 정렬 */
    align-items: center; /* 세로 중앙 정렬 */
    font-size: 24px; /* 글자 크기 */
}

</style>
<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<script type="text/javascript">

	// 개별삭제
	function del(delnum){
		$.ajax({
			url:'/cart/deleteone',
			method:'delete',
			cache:false,
			data:  {'delnum':delnum},
			dataType:'json',
			beforeSend : function(xhr) {
				xhr.setRequestHeader("[[${_csrf.headerName}]]", "[[${_csrf.token}]]");
			},
			success:function(res){
				if(res.deleted) alert('삭제성공');
				location.reload();
			},
			error:function(xhr,status,err){
				alert(status+", "+ err);
			}
		});
	};

	// 체크삭제
	function delcheck(){
		var obj = {};
		obj.checked = $('#cartForm').serialize();
		if(obj.checked==""){
			alert('체크된 항목이 없습니다');
			return null;
		}
		$.ajax({
			url:'/cart/delete',
			method:'delete',
			cache:false,
			data: obj,
			dataType:'json',
			beforeSend : function(xhr) {
				xhr.setRequestHeader("[[${_csrf.headerName}]]", "[[${_csrf.token}]]");
			},
			success:function(res){
				if(res.deleted) alert('삭제성공');
				location.reload();
			},
			error:function(xhr,status,err){
				alert(status+", "+ err);
			}
		});
	};
	
// 구매페이지로 이동 // 체크한 것들만 뜨게 한다
function buypage() {
    var form = document.getElementById('cartForm');
    var isChecked = false;  // 체크된 항목이 있는지 추적

    // 모든 체크박스 검사
    $(form).find('input[name="check"]').each(function() {
        var checkbox = $(this);
        var selectElement = $(this).closest('tr').find('select.size')[0];

        if (checkbox.is(':checked')) {
            isChecked = true;  // 하나라도 체크되었으면 true
            selectElement.disabled = false;  // 활성화 상태 유지
        } else {
            selectElement.disabled = true;  // 체크되지 않은 항목의 select를 비활성화
        }
    });

    if (!isChecked) {
        alert('체크된 항목이 없습니다');
        return false;  // 폼 제출 취소
    }

    form.submit();  // 폼 제출
}

// 전체선택 기능
$(document).ready(function() {
    $("#selectAll").click(function() {
        // 모든 체크박스의 상태 확인(올체크 상태에서 누르면 모두 체크 해제하는 기능을 위한 코드)
        var isAllChecked = $("input:checkbox[name=check]").length === $("input:checkbox[name=check]:checked").length;
        // 모두 체크되어 있다면 모두 체크 해제, 아니면 모두 체크
        $("input:checkbox[name=check]").prop('checked', !isAllChecked);
    });
});

	
</script>

</head>
<body>
<div class="all">
	<h2>내 장바구니</h2>
	<!--<div class="searchdiv">
		<input type="text" name="searchcart">
		<button type="button" onclick="search();">검색</button>
	</div>-->
	<form id="cartForm" method="get" action="/cart/buypage"> <!-- 구매페이지 이동에 필요한 코드 -->
    <table>
        <tr>
			<th></th>
			<th><button type="button" id="selectAll">전체선택</button></th>
            <th>상품이미지</th>
            <th>상품이름</th>
            <th>상품가격</th>
            <th>상품사이즈</th>
            <th>삭제</th>
        </tr>
        <tr th:each="c,i : ${cartList}">
			<td th:text="${i.index+1}"></td>			
			<td>
				<div>
					<input type="checkbox" name="check" th:value="${c.cnum}" checked>
				</div>

			</td>
			
			<td> 
			<div class="image-container">
					<img class="image1" th:src="${c.imgSrc}">
				</div>
			</td>
			<td th:text="${c.productName}"></td>
			<td th:text="${c.productPrice}"></td>
				<td>
				<select id="size" class="size" name="size">
				  <option th:value="0">S</option>
				  <option th:value="1">M</option>
				  <option th:value="2">L</option>
				  <option th:value="3">XL</option>
				  <option th:value="4">XXL</option>
				</select>
			</td>
			<td><button type="button" th:attr="onclick=|del('${c.cnum}');|">삭제</button></td>
		</tr>
	</table>
	</form>
	<button type="button" onclick="buypage();">구매페이지로 이동</button>
	<button type="button" onclick="delcheck();">선택항목 삭제</button>
	<a href="/cart/uoList"><button type="button">주문내역</button></a>
</div>
</body>
</html>
